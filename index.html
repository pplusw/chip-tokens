<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chip Color Tokens – Vzorník</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
<style>
  :root {
    --accent: #FF6D0A; --accent-hover: #e5600a; --accent-bg: #FFF7F2; --accent-light: #FFF2E8;
    --bg: #F5F3F0; --bg-card: #fff; --bg-card-hover: rgba(0,0,0,.06);
    --text: #1a1a1a; --text-heading: #111; --text-muted: #999; --text-dim: #bbb; --text-code: #777;
    --border: #ddd; --border-light: #eee; --border-card: #e8e5e0; --border-ctrl: #e0e0e0;
    --modal-bg: rgba(0,0,0,.4); --toast-bg: #1a1a1a; --toast-text: #fff;
    --swatch-border: rgba(0,0,0,.06);
    color-scheme: light;
  }
  [data-theme="dark"] {
    --accent: #FF8533; --accent-hover: #FF6D0A; --accent-bg: rgba(255,109,10,.12); --accent-light: rgba(255,109,10,.08);
    --bg: #161618; --bg-card: #1e1e21; --bg-card-hover: rgba(255,255,255,.04);
    --text: #e0e0e0; --text-heading: #f0f0f0; --text-muted: #777; --text-dim: #555; --text-code: #888;
    --border: #333; --border-light: #2a2a2d; --border-card: #2a2a2d; --border-ctrl: #3a3a3d;
    --modal-bg: rgba(0,0,0,.6); --toast-bg: #f0f0f0; --toast-text: #111;
    --swatch-border: rgba(255,255,255,.08);
    color-scheme: dark;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'DM Sans', system-ui, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; padding: 40px 24px; transition: background .3s, color .3s; }
  .container { max-width: 960px; margin: 0 auto; }

  /* Header */
  header { margin-bottom: 36px; display: flex; align-items: flex-end; justify-content: space-between; gap: 16px; flex-wrap: wrap; }
  h1 { font-size: 26px; font-weight: 700; letter-spacing: -0.5px; color: var(--text-heading); }
  .subtitle { font-size: 13px; color: var(--text-muted); margin-top: 4px; }
  .base-color { display: flex; align-items: center; gap: 10px; padding: 8px 16px 8px 8px; background: var(--bg-card); border-radius: 12px; border: 1px solid var(--border-card); }
  .base-color-swatch { width: 36px; height: 36px; border-radius: 8px; background: var(--accent); }
  .base-color-label { font-family: 'JetBrains Mono', monospace; font-size: 14px; font-weight: 500; color: var(--accent); }
  .base-color-desc { font-size: 11px; color: var(--text-muted); }

  /* Info bar */
  .edit-info { display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--text-muted); margin-bottom: 20px; padding: 12px 16px; background: var(--bg-card); border-radius: 10px; border: 1px dashed var(--border); line-height: 1.5; flex-wrap: wrap; }
  .edit-info .mi { font-size: 16px; color: var(--accent); }

  /* Buttons */
  .export-bar { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
  .btn { display: inline-flex; align-items: center; gap: 6px; padding: 9px 16px; border-radius: 10px; border: 1px solid var(--border); background: var(--bg-card); font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 500; color: var(--text); cursor: pointer; transition: all .15s; }
  .btn:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-bg); }
  .btn:active { transform: scale(.97); }
  .btn svg { width: 15px; height: 15px; }
  .btn--primary { background: var(--accent); color: #fff; border-color: var(--accent); }
  .btn--primary:hover { background: var(--accent-hover); color: #fff; }

  /* Toast */
  .toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%) translateY(80px); background: var(--toast-bg); color: var(--toast-text); padding: 10px 20px; border-radius: 10px; font-size: 13px; font-family: 'JetBrains Mono', monospace; opacity: 0; transition: all .3s cubic-bezier(.34,1.56,.64,1); z-index: 300; pointer-events: none; }
  .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

  /* Rows */
  .rows { display: flex; flex-direction: column; gap: 3px; }
  .row { display: grid; grid-template-columns: 380px 1fr; align-items: center; padding: 18px 24px; background: var(--bg-card); border-radius: 14px; transition: box-shadow .2s, background .3s; }
  .row:hover { box-shadow: 0 2px 16px var(--bg-card-hover); }
  .row-left { display: flex; flex-direction: column; gap: 8px; }
  .chip-row { display: flex; align-items: center; gap: 8px; }

  /* Chip */
  .chip { display: inline-flex; align-items: center; gap: 7px; padding: 5px 14px 5px 9px; border-radius: 999px; font-size: 13px; font-weight: 500; width: fit-content; transition: transform .15s, box-shadow .15s; cursor: default; }
  .chip:hover { transform: scale(1.03); }
  .chip-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
  .chip-icon { font-size: 16px; flex-shrink: 0; line-height: 1; }
  .hidden { display: none; }
  .chip-label { outline: none; border: none; background: none; font: inherit; color: inherit; padding: 0; cursor: default; min-width: 40px; }
  .chip-label:focus { cursor: text; }
  .chip.editing { box-shadow: 0 0 0 2px currentColor; transform: scale(1.03); }
  .token-name { font-family: 'JetBrains Mono', monospace; font-size: 10.5px; color: var(--text-dim); padding-left: 2px; letter-spacing: -0.3px; }

  /* Controls */
  .chip-controls { display: flex; gap: 4px; opacity: 0; transition: opacity .15s; }
  .row:hover .chip-controls { opacity: 1; }
  .ctrl-btn { width: 28px; height: 28px; border-radius: 7px; border: 1px solid var(--border-ctrl); background: var(--bg-card); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all .15s; color: var(--text-muted); }
  .ctrl-btn:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-bg); }
  .ctrl-btn.active { background: var(--accent); color: #fff; border-color: var(--accent); }
  .ctrl-btn .mi { font-size: 16px; }

  /* Shared icon picker */
  .icon-picker { position: fixed; background: var(--bg-card); border: 1px solid var(--border-ctrl); border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,.15); padding: 8px; z-index: 250; width: 252px; display: none; }
  .icon-picker.open { display: block; }
  .icon-picker-search { width: 100%; border: 1px solid var(--border-light); border-radius: 8px; padding: 7px 10px; font-size: 12px; font-family: 'DM Sans', sans-serif; outline: none; margin-bottom: 6px; background: var(--bg); color: var(--text); }
  .icon-picker-search:focus { border-color: var(--accent); }
  .icon-picker-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 2px; max-height: 200px; overflow-y: auto; }
  .icon-picker-grid::-webkit-scrollbar { width: 4px; }
  .icon-picker-grid::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
  .ip-item { width: 34px; height: 34px; display: flex; align-items: center; justify-content: center; border-radius: 6px; cursor: pointer; transition: background .1s, color .1s; border: none; background: none; color: var(--text-muted); }
  .ip-item:hover { background: var(--accent-light); color: var(--accent); }
  .ip-item.selected { background: var(--accent); color: #fff; }
  .ip-item .mi { font-size: 20px; }
  .ip-none { padding: 6px; font-size: 11px; color: var(--text-muted); cursor: pointer; border-radius: 6px; text-align: center; border: none; background: none; width: 100%; }
  .ip-none:hover { background: var(--accent-light); color: var(--accent); }

  /* Swatches */
  .row-right { display: flex; gap: 16px; justify-content: flex-end; }
  .swatch { display: flex; flex-direction: column; align-items: center; gap: 5px; cursor: pointer; transition: transform .15s; }
  .swatch:hover { transform: scale(1.08); }
  .swatch:active { transform: scale(.94); }
  .swatch-box { width: 48px; height: 48px; border-radius: 10px; border: 1px solid var(--swatch-border); transition: border-radius .2s; }
  .swatch:hover .swatch-box { border-radius: 14px; }
  .swatch-hex { font-family: 'JetBrains Mono', monospace; font-size: 9.5px; color: var(--text-code); letter-spacing: -0.3px; }
  .swatch-label { font-size: 8.5px; color: var(--text-dim); text-transform: uppercase; letter-spacing: .8px; font-weight: 500; }

  /* Modal */
  .modal-overlay { position: fixed; inset: 0; background: var(--modal-bg); backdrop-filter: blur(4px); display: none; align-items: center; justify-content: center; z-index: 200; padding: 24px; }
  .modal-overlay.open { display: flex; }
  .modal { background: var(--bg-card); border-radius: 16px; width: 100%; max-width: 640px; max-height: 80vh; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 24px 64px rgba(0,0,0,.3); }
  .modal-header { display: flex; align-items: center; justify-content: space-between; padding: 20px 24px; border-bottom: 1px solid var(--border-light); }
  .modal-title { font-size: 16px; font-weight: 600; }
  .modal-close { width: 32px; height: 32px; border-radius: 8px; border: none; background: var(--accent-light); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; color: var(--text-muted); }
  .modal-close:hover { background: var(--accent-bg); }
  .modal-body { padding: 20px 24px; overflow-y: auto; flex: 1; }
  .modal-body pre { font-family: 'JetBrains Mono', monospace; font-size: 12px; line-height: 1.7; color: var(--text); white-space: pre-wrap; word-break: break-all; }
  .modal-footer { display: flex; justify-content: flex-end; gap: 8px; padding: 16px 24px; border-top: 1px solid var(--border-light); }

  /* Theme toggle */
  .theme-toggle { width: 40px; height: 40px; border-radius: 10px; border: 1px solid var(--border-card); background: var(--bg-card); cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--text-muted); transition: all .2s; flex-shrink: 0; }
  .theme-toggle:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-bg); }
  .theme-toggle .mi { font-size: 20px; transition: transform .3s; }
  [data-theme="dark"] .theme-toggle .mi { transform: rotate(180deg); }

  @media (max-width: 750px) {
    .row { grid-template-columns: 1fr; gap: 14px; }
    .row-right { justify-content: flex-start; }
    .chip-controls { opacity: 1; }
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <div>
      <h1>Chip Color Tokens</h1>
      <p class="subtitle">Vzorník barev pro Figma · Klikni na swatch pro kopírování HEX</p>
    </div>
    <div style="display:flex;align-items:center;gap:10px">
      <button class="theme-toggle" id="themeToggle" title="Přepnout tmavý/světlý režim">
        <span class="mi material-icons-outlined">dark_mode</span>
      </button>
      <div class="base-color">
        <div class="base-color-swatch"></div>
        <div>
          <div class="base-color-label">#FF6D0A</div>
          <div class="base-color-desc">Base color</div>
        </div>
      </div>
    </div>
  </header>

  <div class="edit-info">
    <span class="mi material-icons-outlined">info</span>
    <span><strong>Dvojklik</strong> na text chipu pro editaci · <strong>Tečka</strong> zapne/vypne dot · <strong>Ikona</strong> otevře výběr Material Design ikon · Změny se promítnou do exportu</span>
  </div>

  <div class="export-bar" id="exportBar"></div>
  <div class="rows" id="rows"></div>
</div>

<div class="toast" id="toast"></div>

<!-- Single shared icon picker -->
<div class="icon-picker" id="iconPicker">
  <input type="text" class="icon-picker-search" id="iconSearch" placeholder="Hledat ikonu...">
  <button class="ip-none" id="iconNone">✕ Bez ikony (použít dot)</button>
  <div class="icon-picker-grid" id="iconGrid"></div>
</div>

<!-- Export modal -->
<div class="modal-overlay" id="modal">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-header">
      <span class="modal-title" id="modalTitle">Export</span>
      <button class="modal-close" id="modalClose">&times;</button>
    </div>
    <div class="modal-body"><pre id="modalCode"></pre></div>
    <div class="modal-footer">
      <button class="btn" id="modalCopy"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>Kopírovat</button>
      <button class="btn btn--primary" id="modalDownload"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>Stáhnout</button>
    </div>
  </div>
</div>

<script>
(() => {
'use strict';

// ── Theme ──
const html = document.documentElement;
const themeBtn = document.getElementById('themeToggle');
const themeIcon = themeBtn.querySelector('.mi');
const savedTheme = localStorage.getItem('chip-theme') || (matchMedia('(prefers-color-scheme:dark)').matches ? 'dark' : 'light');
html.dataset.theme = savedTheme;
themeIcon.textContent = savedTheme === 'dark' ? 'light_mode' : 'dark_mode';

themeBtn.addEventListener('click', () => {
  const next = html.dataset.theme === 'dark' ? 'light' : 'dark';
  html.dataset.theme = next;
  themeIcon.textContent = next === 'dark' ? 'light_mode' : 'dark_mode';
  localStorage.setItem('chip-theme', next);
});

// ── Data ──
const MD_ICONS = 'check_circle,cancel,error,warning,info,help,schedule,update,verified,pending,task_alt,published_with_changes,build,settings,tune,construction,engineering,handyman,description,article,edit_document,note,summarize,content_paste,assignment,assignment_turned_in,assignment_late,assignment_return,flag,bookmark,label,sell,loyalty,new_releases,gavel,policy,security,shield,lock,admin_panel_settings,search,analytics,insights,trending_up,monitoring,assessment,send,forward,reply,archive,delete,restore,visibility,visibility_off,done,done_all,remove_done,sync,bolt,auto_fix_high,star,grade,thumb_up,thumb_down,notifications,campaign,announcement,report,bug_report,feedback,person,group,groups,support_agent,contact_support,manage_accounts,folder,topic,inventory,category,local_offer,receipt,event,today,calendar_month,timer,hourglass_empty,history,link,attach_file,cloud_upload,cloud_download,file_download,file_upload,code,terminal,data_object,integration_instructions,api,developer_mode,palette,brush,design_services,format_paint,color_lens,auto_awesome'.split(',');

const chips = {
  obecnePrideleni:                { label: 'Obecné přidělení',                bg: '#FFF2E8', border: '#FFB880', text: '#CC5700', dot: '#FF6D0A', showDot: true, icon: null },
  realizovaneNapravneOpatreni:    { label: 'Realizované nápravné opatření',   bg: '#E8F5EC', border: '#7ACB95', text: '#1A6B38', dot: '#2E9E5A', showDot: true, icon: null },
  vyjadreni:                      { label: 'Vyjádření',                       bg: '#EBF2FF', border: '#93B8FC', text: '#1E4FAA', dot: '#3B82F6', showDot: true, icon: null },
  analyza:                        { label: 'Analýza',                         bg: '#F1EDFF', border: '#B8A4FB', text: '#5B32C7', dot: '#8B5CF6', showDot: true, icon: null },
  ulozeneNapravneOpatreni:        { label: 'Uložené nápravné opatření',       bg: '#FEF3E2', border: '#F0BE5E', text: '#92570A', dot: '#D97706', showDot: true, icon: null },
  ulozeneKorektivniOpatreni:      { label: 'Uložené korektivní opatření',     bg: '#FDECE8', border: '#F09A82', text: '#A0350E', dot: '#DC4A1A', showDot: true, icon: null },
  realizovaneKorektivniOpatreni:  { label: 'Realizované korektivní opatření', bg: '#E5F7EB', border: '#6DC98E', text: '#0D6930', dot: '#16A34A', showDot: true, icon: null },
  realizaceNapravyDokumentu:      { label: 'Realizace nápravy dokumentu',     bg: '#E6F6F5', border: '#6BCAC2', text: '#0A6B63', dot: '#0D9488', showDot: true, icon: null },
  technickaZmena:                 { label: 'Technická změna',                 bg: '#F3EBE6', border: '#C48E6A', text: '#6E3518', dot: '#A0522D', showDot: true, icon: null },
  restrikceASankce:               { label: 'Restrikce a sankce',              bg: '#FDE8E8', border: '#F08080', text: '#991B1B', dot: '#DC2626', showDot: true, icon: null },
  naprava:                        { label: 'Náprava',                         bg: '#FEF6E2', border: '#F5C85A', text: '#8C5E0A', dot: '#F59E0B', showDot: true, icon: null },
};

// ── DOM cache ──
const $ = id => document.getElementById(id);
const toastEl = $('toast');
const rowsEl = $('rows');
const modalEl = $('modal');
const modalTitle = $('modalTitle');
const modalCode = $('modalCode');
const iconPicker = $('iconPicker');
const iconSearch = $('iconSearch');
const iconGrid = $('iconGrid');
const exportBar = $('exportBar');

// Per-chip DOM refs: { key: { dot, icon, label, dotBtn } }
const refs = {};

// ── Helpers ──
const toKebab = s => s.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
let toastTimer;
function toast(msg) {
  toastEl.textContent = msg;
  toastEl.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => toastEl.classList.remove('show'), 1500);
}

// ── Icon picker (single shared instance) ──
let pickerKey = null;

// Build icon grid once
const fragment = document.createDocumentFragment();
MD_ICONS.forEach(ic => {
  const btn = document.createElement('button');
  btn.className = 'ip-item';
  btn.dataset.icon = ic;
  btn.title = ic;
  btn.innerHTML = `<span class="mi material-icons-outlined">${ic}</span>`;
  fragment.appendChild(btn);
});
iconGrid.appendChild(fragment);

function openPicker(key, anchorEl) {
  pickerKey = key;
  const rect = anchorEl.getBoundingClientRect();
  iconPicker.style.top = (rect.bottom + 4) + 'px';
  iconPicker.style.left = Math.min(rect.left, window.innerWidth - 260) + 'px';
  // Highlight current selection
  const current = chips[key].icon;
  iconGrid.querySelectorAll('.ip-item').forEach(b => {
    b.classList.toggle('selected', b.dataset.icon === current);
    b.style.display = '';
  });
  iconSearch.value = '';
  iconPicker.classList.add('open');
  iconSearch.focus();
}

function closePicker() {
  iconPicker.classList.remove('open');
  pickerKey = null;
}

function applyIcon(key, iconName) {
  const c = chips[key], r = refs[key];
  c.icon = iconName;
  if (iconName) {
    r.icon.textContent = iconName;
    r.icon.classList.remove('hidden');
    r.dot.classList.add('hidden');
    c.showDot = false;
    r.dotBtn.classList.remove('active');
  } else {
    r.icon.classList.add('hidden');
    r.icon.textContent = '';
    c.showDot = true;
    r.dot.classList.remove('hidden');
    r.dotBtn.classList.add('active');
  }
  closePicker();
  toast(iconName ? '✓ Ikona: ' + iconName : '✓ Ikona odebrána');
}

// Icon grid click (event delegation)
iconGrid.addEventListener('click', e => {
  const item = e.target.closest('.ip-item');
  if (item && pickerKey) applyIcon(pickerKey, item.dataset.icon);
});

$('iconNone').addEventListener('click', () => {
  if (pickerKey) applyIcon(pickerKey, null);
});

iconSearch.addEventListener('input', () => {
  const q = iconSearch.value.toLowerCase().trim();
  iconGrid.querySelectorAll('.ip-item').forEach(b => {
    b.style.display = (!q || b.dataset.icon.includes(q)) ? '' : 'none';
  });
});

// Close picker on outside click
document.addEventListener('click', e => {
  if (iconPicker.classList.contains('open') && !e.target.closest('#iconPicker') && !e.target.closest('.ctrl-btn[data-action="icon"]')) {
    closePicker();
  }
});

// ── Render rows (event delegation on container) ──
const LAYERS = ['dot', 'text', 'border', 'bg'];
const svgFile = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>';

Object.entries(chips).forEach(([key, c]) => {
  const row = document.createElement('div');
  row.className = 'row';
  row.innerHTML = `
    <div class="row-left">
      <div class="chip-row">
        <div class="chip" style="background:${c.bg};border:1px solid ${c.border};color:${c.text}">
          <div class="chip-dot${c.showDot ? '' : ' hidden'}" style="background:${c.dot}"></div>
          <span class="chip-icon mi material-icons-outlined${c.icon ? '' : ' hidden'}" style="color:${c.dot}">${c.icon || ''}</span>
          <span class="chip-label" data-key="${key}">${c.label}</span>
        </div>
        <div class="chip-controls">
          <button class="ctrl-btn${c.showDot ? ' active' : ''}" data-action="dot" data-key="${key}" title="Zapnout/vypnout dot"><span class="mi material-icons-outlined">fiber_manual_record</span></button>
          <button class="ctrl-btn" data-action="icon" data-key="${key}" title="Vybrat ikonu"><span class="mi material-icons-outlined">emoji_symbols</span></button>
        </div>
      </div>
      <span class="token-name">${key}</span>
    </div>
    <div class="row-right">
      ${LAYERS.map(l => `<div class="swatch" data-hex="${c[l]}">
        <div class="swatch-box" style="background:${c[l]}"></div>
        <span class="swatch-hex">${c[l]}</span>
        <span class="swatch-label">${l}</span>
      </div>`).join('')}
    </div>`;
  rowsEl.appendChild(row);

  // Cache refs
  const chip = row.querySelector('.chip');
  refs[key] = {
    dot: chip.querySelector('.chip-dot'),
    icon: chip.querySelector('.chip-icon'),
    label: chip.querySelector('.chip-label'),
    dotBtn: row.querySelector('[data-action="dot"]'),
  };
});

// ── Event delegation for rows ──
rowsEl.addEventListener('click', e => {
  // Swatch copy
  const swatch = e.target.closest('.swatch');
  if (swatch) {
    navigator.clipboard.writeText(swatch.dataset.hex).then(() => toast('✓ ' + swatch.dataset.hex));
    return;
  }
  // Dot toggle
  const dotBtn = e.target.closest('[data-action="dot"]');
  if (dotBtn) {
    const key = dotBtn.dataset.key, c = chips[key], r = refs[key];
    c.showDot = !c.showDot;
    r.dot.classList.toggle('hidden', !c.showDot);
    dotBtn.classList.toggle('active', c.showDot);
    // If turning dot on, remove icon
    if (c.showDot && c.icon) {
      c.icon = null;
      r.icon.classList.add('hidden');
      r.icon.textContent = '';
    }
    toast(c.showDot ? '✓ Dot zapnut' : '✓ Dot vypnut');
    return;
  }
  // Icon picker
  const iconBtn = e.target.closest('[data-action="icon"]');
  if (iconBtn) {
    const key = iconBtn.dataset.key;
    if (pickerKey === key && iconPicker.classList.contains('open')) {
      closePicker();
    } else {
      openPicker(key, iconBtn);
    }
    return;
  }
});

// ── Inline label editing (event delegation) ──
rowsEl.addEventListener('dblclick', e => {
  const label = e.target.closest('.chip-label');
  if (!label) return;
  const key = label.dataset.key;
  label.closest('.chip').classList.add('editing');
  label.contentEditable = true;
  label.focus();
  const range = document.createRange();
  range.selectNodeContents(label);
  const sel = window.getSelection();
  sel.removeAllRanges();
  sel.addRange(range);
});

rowsEl.addEventListener('focusout', e => {
  const label = e.target.closest('.chip-label');
  if (!label || label.contentEditable !== 'true') return;
  const key = label.dataset.key;
  label.closest('.chip').classList.remove('editing');
  label.contentEditable = false;
  const val = label.textContent.trim();
  if (val) {
    chips[key].label = val;
    toast('✓ Přejmenováno: ' + val);
  } else {
    label.textContent = chips[key].label;
  }
});

rowsEl.addEventListener('keydown', e => {
  const label = e.target.closest('.chip-label');
  if (!label || label.contentEditable !== 'true') return;
  if (e.key === 'Enter') { e.preventDefault(); label.blur(); }
  if (e.key === 'Escape') { label.textContent = chips[label.dataset.key].label; label.blur(); }
});

// ── Export bar ──
const FORMATS = {
  json:    { label: 'JSON',           ext: 'json' },
  css:     { label: 'CSS Variables',  ext: 'css' },
  scss:    { label: 'SCSS',           ext: 'scss' },
  tailwind:{ label: 'Tailwind',       ext: 'js' },
  ts:      { label: 'TypeScript',     ext: 'ts' },
  figma:   { label: 'Figma Variables',ext: 'json' },
};

Object.entries(FORMATS).forEach(([fmt, { label }]) => {
  const btn = document.createElement('button');
  btn.className = 'btn';
  btn.dataset.fmt = fmt;
  btn.innerHTML = svgFile + label;
  exportBar.appendChild(btn);
});

exportBar.addEventListener('click', e => {
  const btn = e.target.closest('.btn');
  if (btn?.dataset.fmt) openExportModal(btn.dataset.fmt);
});

// ── Export generators ──
function getExportData() {
  const out = {};
  for (const [k, c] of Object.entries(chips)) {
    out[k] = { label: c.label, bg: c.bg, border: c.border, text: c.text, dot: c.dot, showDot: c.showDot };
    if (c.icon) out[k].icon = c.icon;
  }
  return out;
}

function generateExport(fmt) {
  const data = getExportData();
  const entries = Object.entries(data);

  switch (fmt) {
    case 'json': return JSON.stringify(data, null, 2);

    case 'css':
      return ':root {\n' + entries.map(([k, c]) => {
        const n = toKebab(k);
        return `  /* ${c.label}${c.icon ? ` [icon: ${c.icon}]` : ''}${!c.showDot ? ' [no-dot]' : ''} */\n  --chip-${n}-bg: ${c.bg};\n  --chip-${n}-border: ${c.border};\n  --chip-${n}-text: ${c.text};\n  --chip-${n}-dot: ${c.dot};`;
      }).join('\n\n') + '\n}';

    case 'scss': {
      const vars = entries.map(([k, c]) => {
        const n = toKebab(k);
        return `// ${c.label}\n$chip-${n}-bg: ${c.bg};\n$chip-${n}-border: ${c.border};\n$chip-${n}-text: ${c.text};\n$chip-${n}-dot: ${c.dot};`;
      }).join('\n\n');
      const map = entries.map(([k, c], i) => {
        const n = toKebab(k);
        let v = `bg: $chip-${n}-bg, border: $chip-${n}-border, text: $chip-${n}-text, dot: $chip-${n}-dot, show-dot: ${c.showDot}`;
        if (c.icon) v += `, icon: "${c.icon}"`;
        return `  "${n}": (${v})${i < entries.length - 1 ? ',' : ''}`;
      }).join('\n');
      return `// Chip Color Tokens\n\n${vars}\n\n$chip-colors: (\n${map}\n);\n`;
    }

    case 'tailwind':
      return '// tailwind.config.js\nmodule.exports = {\n  theme: {\n    extend: {\n      colors: {\n        chip: {\n' +
        entries.map(([k, c]) => `          '${toKebab(k)}': { bg: '${c.bg}', border: '${c.border}', text: '${c.text}', dot: '${c.dot}' },`).join('\n') +
        '\n        },\n      },\n    },\n  },\n};';

    case 'ts': {
      const obj = entries.map(([k, c]) => {
        let p = `label: '${c.label}', bg: '${c.bg}', border: '${c.border}', text: '${c.text}', dot: '${c.dot}', showDot: ${c.showDot}`;
        if (c.icon) p += `, icon: '${c.icon}'`;
        return `  ${k}: { ${p} },`;
      }).join('\n');
      return `export const chipColors = {\n${obj}\n} as const;\n\nexport type ChipColorKey = keyof typeof chipColors;\nexport type ChipColorToken = {\n  label: string; bg: string; border: string; text: string; dot: string;\n  icon?: string; showDot: boolean;\n};\n`;
    }

    case 'figma': {
      const obj = { chip: {} };
      entries.forEach(([k, c]) => {
        const n = toKebab(k);
        const e = {
          bg:     { value: c.bg,     type: 'color', description: `${c.label} – pozadí` },
          border: { value: c.border, type: 'color', description: `${c.label} – okraj` },
          text:   { value: c.text,   type: 'color', description: `${c.label} – text` },
          dot:    { value: c.dot,    type: 'color', description: `${c.label} – indikátor` },
          showDot:{ value: c.showDot, type: 'boolean' },
        };
        if (c.icon) e.icon = { value: c.icon, type: 'other', description: 'Material icon' };
        obj.chip[n] = e;
      });
      return '// Figma Token Studio format\n' + JSON.stringify(obj, null, 2);
    }
  }
}

// ── Modal ──
let currentFmt = '', currentCode = '';

function openExportModal(fmt) {
  currentFmt = fmt;
  currentCode = generateExport(fmt);
  modalTitle.textContent = 'Export – ' + FORMATS[fmt].label;
  modalCode.textContent = currentCode;
  modalEl.classList.add('open');
}

function closeModal(e) {
  if (!e || e.target === modalEl) modalEl.classList.remove('open');
}

modalEl.addEventListener('click', closeModal);
$('modalClose').addEventListener('click', () => modalEl.classList.remove('open'));
$('modalCopy').addEventListener('click', () => {
  navigator.clipboard.writeText(currentCode).then(() => toast('✓ ' + FORMATS[currentFmt].label + ' zkopírován'));
});
$('modalDownload').addEventListener('click', () => {
  const name = 'chip-tokens.' + FORMATS[currentFmt].ext;
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([currentCode], { type: 'text/plain;charset=utf-8' }));
  a.download = name;
  a.click();
  URL.revokeObjectURL(a.href);
  toast('✓ Staženo: ' + name);
});

document.addEventListener('keydown', e => { if (e.key === 'Escape') { closePicker(); modalEl.classList.remove('open'); } });

})();
</script>
</body>
</html>
